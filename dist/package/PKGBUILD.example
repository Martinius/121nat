pkgname=121Nat
pkgver=1.0 # note: if the pkgver had been '0.99-10' then use an underscore. like '0.99_10'
pkgrel=1
pkgdesc="transparent one to one nat"
arch=(any)
url="http://www.foo.org"
license=('MIT')
depends=('pth' 'libpcap' 'python2' 'jsoncpp')
makedepends=('cmake')
source=(./$pkgname-$pkgver.tar.gz)
md5sums=('0e1494ebbcf0b0ca1bfa8475c5078f21')

build() {
  cd "${srcdir}/${pkgname}"
  cd lib
  mkdir -p bin
 # mkdir -p build/jsoncpp/
 # cd  build/jsoncpp/
 # cmake ../../src/jsoncpp -DCMAKE_INSTALL_PREFIX=/usr
 # make
 # cp src/lib_json/libjsoncpp.a ../../bin 
 # cd ../..
  mkdir -p build/libtins/
  cd  build/libtins/
  cmake ../../src/libtins -DLIBTINS_BUILD_SHARED=1 -DLIBTINS_ENABLE_CXX11=1 -DLIBTINS_ENABLE_WPA2=0 -DLIBTINS_ENABLE_DOT11=0 -DHAVE_PCAP_IMMEDIATE_MODE=1 -DCMAKE_INSTALL_PREFIX=/usr
  make
  cp lib/libtins.so ../../bin 
  cd ../../..
  mkdir -p build/121Natbuild
  cd build/121Natbuild
  cmake ../../ -DCMAKE_INSTALL_PREFIX=/usr
  make
  cp src/121Nat ../
}

package() {
  #cd ${srcdir}/${pkgname}/lib/build/jsoncpp
  #make DESTDIR="${pkgdir}" install
  cd "${srcdir}/${pkgname}/lib/build/libtins"
  make DESTDIR="${pkgdir}" install
  cd "${srcdir}/${pkgname}/build/121Natbuild"
  make DESTDIR="${pkgdir}" install
  mkdir -p "${pkgdir}/etc/${pkgname}"
  cp "../../src/config.json" "${pkgdir}/etc/${pkgname}/config-example.json"
  rm -R "${pkgdir}/usr/CMake"
}
